<!-- Banner full-width -->
<div
  class="webp-banner"
  [ngStyle]="{
    'background-image': 'url(' + bannerUrl + ')',
    'height.px': bannerHeight
  }"
>
  <div class="webp-banner__overlay"></div>
  <div class="webp-banner__text">
    <h2>CREACIÓN DE FORMATOS</h2>
    <p>Carga tus imágenes en PNG y crea formatos para tus redes sociales.</p>
    <p>
      Relaciones de aspecto 1:1 (Square), 9:16 (Vertical), 16:9 (Horizontal)
    </p>
  </div>
</div>

<section class="webp-content">
  <!-- input oculto -->
  <input
    #fileInput
    type="file"
    accept="image/png, image/jpeg"
    multiple
    hidden
    (change)="onFilesSelected($event)"
  />

  <!-- ETAPA 1: solo CARGAR -->
  <div *ngIf="step === 'select'" class="stageLoad">
    <img src="/images/bgLoad.png" class="icon" />
    <p class="webp-content__label">Carga máximo 50 imágenes para convertir</p>
    <button mat-raised-button class="btn-color" (click)="fileInput.click()">
      CARGAR
    </button>
  </div>

  <!-- ETAPA 2: Ready (format + acciones) -->
  <ng-container *ngIf="step === 'ready'">
    <div class="format-ready">
      <img src="/images/check_webp.png" class="icon" />
      <p>{{ selectedFiles.length }} imágenes cargadas</p>
    </div>
    <mat-form-field appearance="outline" class="format-select">
      <mat-label>Formato</mat-label>
      <mat-select [(ngModel)]="selectedFormat">
        <mat-option *ngFor="let f of formats" [value]="f.value">
          {{ f.viewValue }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <div *ngIf="step === 'ready'" class="stageConvert">
      <button mat-raised-button (click)="cancelSelection()" class="btn-color">
        CANCELAR
      </button>
      <button
        mat-raised-button
        class="btn-color"
        [disabled]="!canStart"
        (click)="uploadFiles()"
      >
        CONVERTIR
      </button>
    </div>
  </ng-container>

  <!-- ETAPA 3: Procesando -->
  <section class="webp-content" *ngIf="step === 'processing'">
    <img src="/images/loading_webp.png" class="icon" />
    <p class="webp-content__label">Procesando… {{ progress }}%</p>
    <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
  </section>

  <!-- ETAPA 4: TERMINADO -->
  <div *ngIf="step === 'done'" class="stageLoad">
    <img src="/images/loading_webp.png" class="icon" />
  </div>
  <div *ngIf="step === 'done'" class="stageConvert">
    <button mat-raised-button class="btn-color" (click)="reset()">
      FINALIZAR
    </button>
    <button mat-raised-button class="btn-color" (click)="download()">
      DESCARGAR
    </button>
  </div>

  <!-- Mensaje de error global -->
  <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
</section>
